<html>
  <head>
    <title>My experiment</title>
    <script src="static/lib/jquery-min.js"></script>
    <script src="static/js/jspsych/jspsych.js"></script>
    <script src="static/js/jspsych/plugins/jspsych-text.js"></script>
    <script src="static/js/jspsych/plugins/jspsych-instructions.js"></script>
    <script src="static/js/jspsych/plugins/jspsych-single-stim.js"></script>
	<script src="static/js/jspsych/plugins/jspsych-categorize.js"></script>
	<script src="static/js/jspsych/plugins/jspsych-survey-text.js"></script>
	<script src="static/js/load_experiments.js"></script>
    <link href="static/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <link href="static/css/default_style.css" rel="stylesheet" type="text/css"></link>
	
  </head>
  <body>
	  
<script> 

                 // Instead of experiment draw, get experiment name from the url
                 function getUrlVars() {
                     var vars = {};
                     var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
                         vars[key] = value;
                      });
                      return vars;
                 }

                 // Do it.
                 var json_data = getUrlVars()

                 // Default experiment will be stop signal
                 if (typeof json_data["exp"] == 'undefined'){ json_data = "stop_signal";}
                 else { json_data = json_data["exp"].replace("/",""); }

                 // A function to find an experiment from the list in load_experiments.js
                 find_experiment = function(url_var,experiment_list){

                     for (i = 0; i < experiment_list.length; i++) {
                         if (experiment_list[i].name == url_var);
                         console.log([experiment_list[i].name])
                         return [experiment_list[i].name]
                     }

                 }

                experiment_names = find_experiment(json_data,experiment_list)

		var task_list = '<ul list-text>'
		for (i=0; i<experiment_names.length; i++) {
			task_list += '<li>' + experiment_names[i] + '</li>'
		}
		
		var task_list_block = {
		  type: 'text',
		  text: '<div class = centerbox><p class = block-text>In this HIT you will be completing the following tasks: </p>' + task_list + '</ul><p class = block-text>Press <strong>enter</strong> to continue.</p></div>',
		  cont_key: 13
		};
				
		var experiments = []
		experiments.push(task_list_block)
	
                // Read in appropriate experiment files
                load_experiment_from_hub(experiment_names[0])

                // concatenate on the experimental blocks defined for each of the constituent experiments
		cat_experiments(experiments,experiment_name)

		// start the experiment
		jsPsych.init({
		  experiment_structure: experiments,
		  on_finish: function() {
			jsPsych.data.localSave('your_results.csv','csv');
		  }
		});
		
	  </script>
  </body>
</html>
